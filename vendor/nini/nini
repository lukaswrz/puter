#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail

flags=(
    --refresh
    --sudo
    --no-write-lock-file
)

if [[ -v NINI_FLAKE && -n $NINI_FLAKE ]]; then
    flags+=(--flake "$NINI_FLAKE")
fi

cmd=(nixos-rebuild "${flags[@]}" "$@")

echo "running ${cmd[*]}" >&2

exec "${cmd[@]}"
